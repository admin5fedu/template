<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Phi·∫øu l∆∞∆°ng nh√¢n vi√™n</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .month-summary { cursor: pointer; margin: 10px 0; padding: 10px; border: 1px solid #ccc; border-radius: 8px; background: #f9f9f9; }
    .month-summary:hover { background: #eef; }
    .details { display: none; margin-left: 20px; }
    .highlight { font-weight: bold; color: #007BFF; }
  </style>
</head>
<body>
  <h2>Phi·∫øu l∆∞∆°ng nh√¢n vi√™n</h2>
  <div id="info"></div>
  <div id="summary"></div>

  <script>
    // H√†m l·∫•y tham s·ªë tr√™n URL
    function getQueryParam(name) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(name);
    }

    const ma_nv = getQueryParam("ma_nv");
    const apiUrl = "https://script.google.com/macros/s/AKfycbzp2GVzS0E0oYckjEo-P2Ag6PZQVunwx66kxbYo2w1ay5Zjbef2feVgyXykcVE2IIww/exec";

    if (!ma_nv) {
      document.getElementById("info").innerText = "‚ö†Ô∏è Vui l√≤ng truy·ªÅn m√£ nh√¢n vi√™n (?ma_nv=NV001)";
    } else {
      document.getElementById("info").innerHTML = `üìå Hi·ªÉn th·ªã l∆∞∆°ng cho nh√¢n vi√™n <span class="highlight">${ma_nv}</span>`;
      
      fetch(apiUrl)
        .then(response => response.json())
        .then(data => {
          const filtered = data.filter(row => row["M√£ NV"] === ma_nv);
          if (filtered.length === 0) {
            document.getElementById("summary").innerHTML = "‚ùå Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu.";
            return;
          }

          // T·ªïng thu nh·∫≠p theo nƒÉm
          let total = 0;
          filtered.forEach(row => {
            total += parseFloat(row["L∆∞∆°ng th·ª±c l√£nh"]) || 0;
          });

          const year = filtered[0]["NƒÉm"];
          let html = `<h3>T·ªïng thu nh·∫≠p nƒÉm ${year}: <span class="highlight">${total.toLocaleString()} ƒë</span></h3>`;
          html += `<h4>Chi ti·∫øt c√°c th√°ng:</h4>`;

          filtered.sort((a, b) => a["Th√°ng"] - b["Th√°ng"]); // s·∫Øp x·∫øp theo th√°ng

          filtered.forEach((row, index) => {
            const monthId = `details-${index}`;
            html += `
              <div class="month-summary" onclick="toggleDetails('${monthId}')">
                Th√°ng ${row["Th√°ng"]} ‚Äì T·ªïng thu nh·∫≠p: <strong>${parseInt(row["L∆∞∆°ng th·ª±c l√£nh"]).toLocaleString()} ƒë</strong>
                <div class="details" id="${monthId}">
                  <ul>
                    <li>H·ªç v√† t√™n: ${row["H·ªç v√† t√™n"]}</li>
                    <li>Ph√≤ng ban: ${row["Ph√≤ng ban"]}</li>
                    <li>Ch·ª©c v·ª•: ${row["Ch·ª©c v·ª•"]}</li>
                    <li>L∆∞∆°ng c∆° b·∫£n: ${parseInt(row["L∆∞∆°ng c∆° b·∫£n"]).toLocaleString()} ƒë</li>
                    <li>Ph·ª• c·∫•p: ${parseInt(row["Ph·ª• c·∫•p"]).toLocaleString()} ƒë</li>
                    <li>Th∆∞·ªüng: ${parseInt(row["Th∆∞·ªüng"]).toLocaleString()} ƒë</li>
                    <li>Ph·∫°t: ${parseInt(row["Ph·∫°t"]).toLocaleString()} ƒë</li>
                    <li>L∆∞∆°ng th·ª±c l√£nh: <strong>${parseInt(row["L∆∞∆°ng th·ª±c l√£nh"]).toLocaleString()} ƒë</strong></li>
                    <li>Ng√†y c√¥ng: ${row["Ng√†y c√¥ng"]}</li>
                    <li>Ghi ch√∫: ${row["Ghi ch√∫"] || "-"}</li>
                  </ul>
                </div>
              </div>
            `;
          });

          document.getElementById("summary").innerHTML = html;
        })
        .catch(error => {
          document.getElementById("summary").innerText = "‚ùå L·ªói khi t·∫£i d·ªØ li·ªáu.";
          console.error(error);
        });
    }

    function toggleDetails(id) {
      const el = document.getElementById(id);
      if (el.style.display === "none" || el.style.display === "") {
        el.style.display = "block";
      } else {
        el.style.display = "none";
      }
    }
  </script>
</body>
</html>
